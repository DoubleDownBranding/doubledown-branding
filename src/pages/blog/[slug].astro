---
import { getEntryBySlug } from 'astro:content';

const { slug } = Astro.params;
const entry = await getEntryBySlug('blog', slug);
if (!entry) {
  return new Response('Not found', { status: 404 });
}
const { Content, data } = await entry.render();

// SAFE date handling: don't call toISOString on a string
const dateObj = data?.date ? new Date(data.date) : null;
const formattedDate = dateObj
  ? dateObj.toLocaleDateString('en-GB', { year: 'numeric', month: 'long', day: 'numeric' })
  : '';
const dateISO = dateObj ? dateObj.toISOString() : '';
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>{data.title ?? 'Blog post'}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
  </head>
  <body style="font-family: system-ui, sans-serif; padding: 4rem 1rem; max-width: 820px; margin: 0 auto;">
    <h1 style="margin: 0 0 .5rem;">{data.title}</h1>

    {formattedDate && (
      <p style="opacity:.7; margin:.25rem 0 1rem;">
        <time datetime={dateISO}>{formattedDate}</time>
      </p>
    )}

    {data.thumbnail && <img src={data.thumbnail} alt="" style="max-width:100%; height:auto; margin: 1rem 0 2rem;" />}
    <article>
      <Content />
    </article>
    <p style="margin-top:2rem;"><a href="/blog">‚Üê Back to Blog</a></p>
  </body>
</html>
